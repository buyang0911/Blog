收到一个朋友的求救，他现在遇到一个难题。

就是刚刚入职的公司，项目没有GIT,用的老版本的TP,CI，代码也很凌乱，目录也是非常的多，有的没的都在服务器上放着，服务器上还有将近30G的用户头像存着，总之就是一个字 “乱”

我准备对这个乱到无法整理的公司项目、服务器及架构进行重新整理，接下来，请看我的表演～

# 备份
既然没有git，那就不用git了，直接在线上打包，ftp链接上下载，在毫无头绪的情况下，我建议直接重装。。如果你没有十足把握，建议不要送死。

#### 公司业务总结构
* 新接口应用程序
* 后台应用程序
* 老接口应用程序

仔细探查了下，资源文件只有头像存在本地，其他的都存到了七牛上。这样打包就好办了。不会影响到用户的正常使用。

打包后将项目下载到本地。

数据库用的阿里云的，所以直接忽略。

> 此过程做了5个小时。。。东西确实不少。

# 配置
公司用的是Apache，找到vhost文件，拷贝一份到本地，整理一下所有的配置文件，目录什么的。
他公司要求使用Nginx，所以我需要一个个整理出来配置文件，随后再找到ssl for nginx的证书，一切准备就绪。

# 无感知转发
我自己有一台4核4g的阿里云ECS,他们公司的量也不大，所以我准备先将项目部署到我服务器上，在公司服务器上进行负载均衡，将我方IP权重调高，将用户流量全部引入到我方服务器上。
> Demo 如下:
```
ProxyPass / balancer://proxy/
<Proxy balancer://proxy> 
        BalancerMember http://192.168.6.37:6888/  loadfactor=3 
        BalancerMember http://192.168.6.38:6888/  loadfactor=1 
</Proxy> 
```

将用户流量转发后，开始重置敌方服务器，准备进行重新部署。

